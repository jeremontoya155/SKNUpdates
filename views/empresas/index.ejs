<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Sistema de Inventario</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('../partials/header') %>

  <main class="container">
    <div class="page-header">
      <h1>ğŸ¢ GestiÃ³n de Empresas</h1>
      <a href="/empresas/nueva" class="btn btn-primary">â• Nueva Empresa</a>
    </div>

    <% if (message) { %>
      <div class="alert alert-success"><%= message %></div>
    <% } %>
    
    <% if (error) { %>
      <div class="alert alert-error"><%= error %></div>
    <% } %>

    <div class="alert alert-warning">
      âš ï¸ Solo usuarios SKN pueden crear y gestionar empresas
    </div>

    <% if (empresas.length === 0) { %>
      <div class="empty-state">
        <p>ğŸ“­ No hay empresas registradas</p>
        <a href="/empresas/nueva" class="btn btn-primary">Crear primera empresa</a>
      </div>
    <% } else { %>
      <!-- Grid de empresas -->
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: var(--spacing-lg); margin-top: var(--spacing-lg);">
        <% empresas.forEach(emp => { %>
          <div class="empresa-card" style="background: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding: var(--spacing-lg); transition: transform 0.3s ease, box-shadow 0.3s ease; border-left: 4px solid <%= emp.activo ? 'var(--success-color)' : '#ccc' %>;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-md);">
              <div>
                <h3 style="margin: 0 0 8px 0; color: var(--primary-color); font-size: 1.3rem;">
                  ğŸ¢ <%= emp.nombre %>
                </h3>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                  <span class="badge <%= emp.activo ? 'badge-success' : 'badge-secondary' %>" style="font-size: 12px;">
                    <%= emp.activo ? 'âœ… Activa' : 'â¸ï¸ Inactiva' %>
                  </span>
                  <% if (typeof emp.abonada !== 'undefined') { %>
                    <span class="badge <%= emp.abonada ? 'badge-primary' : 'badge-warning' %>" style="font-size: 12px;">
                      <%= emp.abonada ? 'ğŸ’³ Abonada' : 'ğŸ’³ No Abonada' %>
                    </span>
                  <% } %>
                </div>
              </div>
              <div style="display: flex; gap: 4px;">
                <form action="/empresas/<%= emp.id %>/toggle" method="POST" style="margin: 0;">
                  <button type="submit" class="btn-small <%= emp.activo ? 'btn-warning' : 'btn-success' %>" title="<%= emp.activo ? 'Desactivar' : 'Activar' %>">
                    <%= emp.activo ? 'âŒ' : 'âœ…' %>
                  </button>
                </form>
                <% if (user.rol === 'skn_admin') { %>
                  <form action="/empresas/<%= emp.id %>/toggle-abonada" method="POST" style="margin: 0;">
                    <button type="submit" class="btn-small btn-info" title="Cambiar estado de abonada">
                      ğŸ’³
                    </button>
                  </form>
                <% } %>
              </div>
            </div>

            <!-- Info de contacto -->
            <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--border-color);">
              <% if (emp.email) { %>
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                  <span style="color: var(--text-secondary);">ğŸ“§</span>
                  <span style="font-size: 14px;"><%= emp.email %></span>
                </div>
              <% } %>
              <% if (emp.telefono) { %>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span style="color: var(--text-secondary);">ğŸ“</span>
                  <span style="font-size: 14px;"><%= emp.telefono %></span>
                </div>
              <% } %>
            </div>

            <!-- EstadÃ­sticas -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
              <div style="text-align: center; padding: var(--spacing-sm); background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: bold; color: var(--primary-color);"><%= emp.total_usuarios || 0 %></div>
                <div style="font-size: 12px; color: var(--text-secondary);">ğŸ‘¥ Usuarios</div>
              </div>
              <div style="text-align: center; padding: var(--spacing-sm); background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: bold; color: var(--primary-color);"><%= emp.total_materiales || 0 %></div>
                <div style="font-size: 12px; color: var(--text-secondary);">ğŸ“¦ Equipos</div>
              </div>
              <div style="text-align: center; padding: var(--spacing-sm); background: #f5f5f5; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: bold; color: var(--primary-color);"><%= emp.total_sucursales || 0 %></div>
                <div style="font-size: 12px; color: var(--text-secondary);">ğŸª Sucursales</div>
              </div>
            </div>

            <!-- Botones de AcciÃ³n -->
            <div style="display: flex; gap: 8px;">
              <a href="/empresas/<%= emp.id %>" class="btn btn-primary" style="flex: 1; text-align: center;">
                ğŸ‘ï¸ Ver Detalle
              </a>
              <a href="/empresas/<%= emp.id %>/editar" class="btn btn-secondary" style="padding: 10px 16px;">
                âœï¸
              </a>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>

    <style>
      .empresa-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      }

      @media (max-width: 768px) {
        .empresa-card {
          margin-bottom: var(--spacing-md);
        }
      }
    </style>
  </main>

  <%- include('../partials/footer') %>
</body>
</html>
