<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Sistema de Inventario</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('../partials/header') %>

  <main class="container">
    <% if (message) { %>
      <div class="alert alert-success"><%= message %></div>
    <% } %>
    
    <% if (error) { %>
      <div class="alert alert-error"><%= error %></div>
    <% } %>

    <div class="page-header">
      <h1>ğŸ« Tickets / Solicitudes</h1>
      <a href="/tickets/nuevo" class="btn btn-primary">â• Nuevo Ticket</a>
    </div>

    <% if (esSKN) { %>
      <div class="alert alert-info">
        â„¹ï¸ Como usuario SKN, ves TODOS los tickets de todas las empresas. Puedes asignÃ¡rtelos y cambiar su estado.
      </div>
    <% } else { %>
      <div class="alert alert-info">
        â„¹ï¸ Visualizando tickets de tu empresa. Solo puedes crear tickets y agregar comentarios. SKN gestiona los estados.
      </div>
    <% } %>

    <% if (tickets.length === 0) { %>
      <div class="empty-state">
        <p>ğŸ“­ No hay tickets registrados</p>
        <a href="/tickets/nuevo" class="btn btn-primary">Crear primer ticket</a>
      </div>
    <% } else { %>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <% if (esSKN) { %>
                <th>Empresa</th>
              <% } %>
              <th>TÃ­tulo</th>
              <th>Solicitante</th>
              <th>Estado</th>
              <th>Prioridad</th>
              <th>Asignado a</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% tickets.forEach(ticket => { 
              let estadoBadge = '';
              let estadoTexto = '';
              if (ticket.estado === 'abierto') {
                estadoBadge = 'badge-warning';
                estadoTexto = 'â³ Abierto';
              } else if (ticket.estado === 'en_proceso') {
                estadoBadge = 'badge-primary';
                estadoTexto = 'ğŸ”„ En Proceso';
              } else if (ticket.estado === 'cerrado') {
                estadoBadge = 'badge-success';
                estadoTexto = 'âœ… Cerrado';
              } else if (ticket.estado === 'cancelado') {
                estadoBadge = 'badge';
                estadoTexto = 'â›” Cancelado';
              }

              let prioridadBadge = '';
              let prioridadTexto = '';
              if (ticket.prioridad === 'baja') {
                prioridadBadge = 'badge';
                prioridadTexto = 'ğŸŸ¢ Baja';
              } else if (ticket.prioridad === 'media') {
                prioridadBadge = 'badge-warning';
                prioridadTexto = 'ğŸŸ¡ Media';
              } else if (ticket.prioridad === 'alta') {
                prioridadBadge = 'badge-primary';
                prioridadTexto = 'ğŸŸ  Alta';
              } else if (ticket.prioridad === 'urgente') {
                prioridadBadge = 'badge-danger';
                prioridadTexto = 'ğŸ”´ Urgente';
              }
            %>
              <tr>
                <td><strong>#<%= ticket.id %></strong></td>
                <% if (esSKN) { %>
                  <td><%= ticket.empresa_nombre %></td>
                <% } %>
                <td><%= ticket.titulo %></td>
                <td><%= ticket.solicitante_nombre %></td>
                <td><span class="badge <%= estadoBadge %>"><%= estadoTexto %></span></td>
                <td><span class="badge <%= prioridadBadge %>"><%= prioridadTexto %></span></td>
                <td><%= ticket.asignado_nombre || 'âšª Sin asignar' %></td>
                <td><%= new Date(ticket.fecha_creacion).toLocaleDateString('es-AR') %></td>
                <td>
                  <a href="/tickets/<%= ticket.id %>" class="btn btn-sm">ğŸ‘ï¸ Ver</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </main>

  <%- include('../partials/footer') %>
</body>
</html>
