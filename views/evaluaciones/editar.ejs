<%- include('../layouts/main', { title: 'Editar Evaluaci√≥n #' + evaluacion.id + ' - SKN', body: `
  <div class="container">
    <div class="page-header">
      <h1>‚úèÔ∏è Editar Evaluaci√≥n #${evaluacion.id}</h1>
      <a href="/evaluaciones/${evaluacion.id}" class="btn btn-secondary">‚Üê Volver</a>
    </div>

    <div class="form-card">
      <form action="/evaluaciones/${evaluacion.id}" method="POST" enctype="multipart/form-data">
        
        <!-- Secci√≥n: Informaci√≥n B√°sica -->
        <div class="form-section">
          <h3>üë§ Informaci√≥n B√°sica</h3>
          
          <div class="form-group">
            <label for="usuario_evaluado_id">Empleado a Evaluar *</label>
            <select id="usuario_evaluado_id" name="usuario_evaluado_id" required>
              ${usuarios.map(u => `
                <option value="${u.id}" ${evaluacion.usuario_evaluado_id == u.id ? 'selected' : ''}>
                  ${u.nombre} - ${u.email} (${u.empresa_nombre || 'Sin empresa'})
                </option>
              `).join('')}
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="titulo">T√≠tulo de la Evaluaci√≥n *</label>
              <input type="text" id="titulo" name="titulo" required value="${evaluacion.titulo}">
            </div>

            <div class="form-group">
              <label for="tipo">Tipo de Evaluaci√≥n</label>
              <select id="tipo" name="tipo">
                <option value="general" ${evaluacion.tipo === 'general' ? 'selected' : ''}>General</option>
                <option value="desempe√±o" ${evaluacion.tipo === 'desempe√±o' ? 'selected' : ''}>Desempe√±o</option>
                <option value="actitud" ${evaluacion.tipo === 'actitud' ? 'selected' : ''}>Actitud</option>
                <option value="puntualidad" ${evaluacion.tipo === 'puntualidad' ? 'selected' : ''}>Puntualidad</option>
                <option value="trabajo_equipo" ${evaluacion.tipo === 'trabajo_equipo' ? 'selected' : ''}>Trabajo en Equipo</option>
                <option value="anual" ${evaluacion.tipo === 'anual' ? 'selected' : ''}>Evaluaci√≥n Anual</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="descripcion">Descripci√≥n</label>
            <textarea id="descripcion" name="descripcion" rows="3">${evaluacion.descripcion || ''}</textarea>
          </div>
        </div>

        <!-- Secci√≥n: Puntajes -->
        <div class="form-section">
          <h3>‚≠ê Puntajes (1-10)</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="puntaje_desempeno">Desempe√±o</label>
              <input type="number" id="puntaje_desempeno" name="puntaje_desempeno" min="1" max="10" 
                value="${evaluacion.puntaje_desempeno || ''}">
            </div>

            <div class="form-group">
              <label for="puntaje_actitud">Actitud</label>
              <input type="number" id="puntaje_actitud" name="puntaje_actitud" min="1" max="10" 
                value="${evaluacion.puntaje_actitud || ''}">
            </div>

            <div class="form-group">
              <label for="puntaje_puntualidad">Puntualidad</label>
              <input type="number" id="puntaje_puntualidad" name="puntaje_puntualidad" min="1" max="10" 
                value="${evaluacion.puntaje_puntualidad || ''}">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="puntaje_trabajo_equipo">Trabajo en Equipo</label>
              <input type="number" id="puntaje_trabajo_equipo" name="puntaje_trabajo_equipo" min="1" max="10" 
                value="${evaluacion.puntaje_trabajo_equipo || ''}">
            </div>

            <div class="form-group">
              <label for="puntaje_general">‚≠ê Puntaje General *</label>
              <input type="number" id="puntaje_general" name="puntaje_general" min="1" max="10" 
                value="${evaluacion.puntaje_general || ''}">
            </div>
          </div>
        </div>

        <!-- Secci√≥n: Notas Confidenciales -->
        <div class="form-section" style="background: #fff3cd; border: 2px solid #ffc107;">
          <h3>üîí Informaci√≥n Confidencial</h3>
          
          <div class="form-group">
            <label for="notas_confidenciales">Notas Confidenciales</label>
            <textarea id="notas_confidenciales" name="notas_confidenciales" rows="4">${evaluacion.notas_confidenciales || ''}</textarea>
          </div>

          <div class="form-group">
            <label for="contrase√±as_accesos">Contrase√±as y Accesos</label>
            <textarea id="contrase√±as_accesos" name="contrase√±as_accesos" rows="3">${evaluacion.contrase√±as_accesos || ''}</textarea>
          </div>

          <div class="form-group">
            <label for="imagenes">üìé Agregar M√°s Evidencias</label>
            <input type="file" id="imagenes" name="imagenes" multiple accept="image/*,.pdf">
            <small style="color: #666;">Las im√°genes actuales se mantendr√°n. Solo sube nuevas si quieres agregar m√°s.</small>
          </div>

          ${evaluacion.imagenes && evaluacion.imagenes.length > 0 ? `
            <div style="margin-top: 1rem;">
              <strong>Archivos actuales (${evaluacion.imagenes.length}):</strong>
              <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                ${evaluacion.imagenes.map((img, index) => `
                  <a href="${img}" target="_blank" class="btn-small btn-secondary" style="font-size: 0.8rem;">
                    üìé Archivo ${index + 1}
                  </a>
                `).join('')}
              </div>
            </div>
          ` : ''}
        </div>

        <!-- Secci√≥n: Recomendaciones y Decisiones -->
        <div class="form-section">
          <h3>üí° Recomendaciones y Decisiones</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="recomendacion">Recomendaci√≥n</label>
              <select id="recomendacion" name="recomendacion">
                <option value="" ${!evaluacion.recomendacion ? 'selected' : ''}>Sin recomendaci√≥n</option>
                <option value="premio" ${evaluacion.recomendacion === 'premio' ? 'selected' : ''}>üèÜ Premio/Bono</option>
                <option value="aumento" ${evaluacion.recomendacion === 'aumento' ? 'selected' : ''}>üí∞ Aumento de Sueldo</option>
                <option value="capacitacion" ${evaluacion.recomendacion === 'capacitacion' ? 'selected' : ''}>üìö Necesita Capacitaci√≥n</option>
                <option value="advertencia" ${evaluacion.recomendacion === 'advertencia' ? 'selected' : ''}>‚ö†Ô∏è Advertencia</option>
                <option value="despido" ${evaluacion.recomendacion === 'despido' ? 'selected' : ''}>‚ùå Considerar Despido</option>
              </select>
            </div>

            <div class="form-group">
              <label for="monto_sugerido">Monto Sugerido ($)</label>
              <input type="number" id="monto_sugerido" name="monto_sugerido" step="0.01" min="0" 
                value="${evaluacion.monto_sugerido || ''}">
            </div>
          </div>

          <div class="form-group">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" id="aprobado_para_premio" name="aprobado_para_premio" 
                ${evaluacion.aprobado_para_premio ? 'checked' : ''}>
              <strong>‚úÖ Aprobado para premio a fin de a√±o</strong>
            </label>
          </div>
        </div>

        <!-- Secci√≥n: Per√≠odo -->
        <div class="form-section">
          <h3>üìÖ Per√≠odo de Evaluaci√≥n</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="periodo_inicio">Desde</label>
              <input type="date" id="periodo_inicio" name="periodo_inicio" 
                value="${evaluacion.periodo_inicio ? evaluacion.periodo_inicio.split('T')[0] : ''}">
            </div>

            <div class="form-group">
              <label for="periodo_fin">Hasta</label>
              <input type="date" id="periodo_fin" name="periodo_fin" 
                value="${evaluacion.periodo_fin ? evaluacion.periodo_fin.split('T')[0] : ''}">
            </div>
          </div>
        </div>

        <!-- Botones -->
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">üíæ Guardar Cambios</button>
          <a href="/evaluaciones/${evaluacion.id}" class="btn btn-secondary">Cancelar</a>
        </div>
      </form>
    </div>
  </div>

  <style>
    .form-section {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
      border: 1px solid #dee2e6;
    }

    .form-section h3 {
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--primary-color);
    }

    .form-card {
      background: #f8f9fa;
      padding: 2rem;
      border-radius: 8px;
    }
  </style>
` }) %>
