<%- include('../layouts/main', { title: 'Evaluaciones Internas - SKN', body: `
  <div class="container">
    <div class="page-header">
      <div>
        <h1>ğŸ”’ Evaluaciones Internas</h1>
        <p class="subtitle">Sistema confidencial - Solo accesible para fnalbandian@gmail.com</p>
      </div>
      <a href="/evaluaciones/nuevo" class="btn btn-primary">â• Nueva EvaluaciÃ³n</a>
    </div>

    <!-- Banner de seguridad -->
    <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 1rem; border-radius: 8px; margin-bottom: 2rem;">
      <strong>âš ï¸ ÃREA CONFIDENCIAL:</strong> Esta secciÃ³n es EXCLUSIVA para fnalbandian@gmail.com. 
      Los empleados y otros usuarios NO tienen acceso a estas evaluaciones.
    </div>

    <!-- Filtros de bÃºsqueda -->
    <div class="filter-card">
      <h3>ğŸ” Filtros de BÃºsqueda</h3>
      <form method="GET" action="/evaluaciones">
        <div class="form-row">
          <div class="form-group">
            <label for="buscar">Buscar</label>
            <input 
              type="text" 
              id="buscar" 
              name="buscar" 
              placeholder="TÃ­tulo, descripciÃ³n o nombre"
              value="${filtros.buscar || ''}"
            >
          </div>

          <div class="form-group">
            <label for="usuario">Empleado</label>
            <select id="usuario" name="usuario">
              <option value="">Todos los empleados</option>
              ${usuariosSKN.map(u => `
                <option value="${u.id}" ${filtros.usuario == u.id ? 'selected' : ''}>
                  ${u.nombre} - ${u.empresa_nombre || 'Sin empresa'}
                </option>
              `).join('')}
            </select>
          </div>

          <div class="form-group">
            <label for="recomendacion">RecomendaciÃ³n</label>
            <select id="recomendacion" name="recomendacion">
              <option value="">Todas</option>
              <option value="premio" ${filtros.recomendacion === 'premio' ? 'selected' : ''}>ğŸ† Premio</option>
              <option value="aumento" ${filtros.recomendacion === 'aumento' ? 'selected' : ''}>ğŸ’° Aumento</option>
              <option value="capacitacion" ${filtros.recomendacion === 'capacitacion' ? 'selected' : ''}>ğŸ“š CapacitaciÃ³n</option>
              <option value="advertencia" ${filtros.recomendacion === 'advertencia' ? 'selected' : ''}>âš ï¸ Advertencia</option>
              <option value="despido" ${filtros.recomendacion === 'despido' ? 'selected' : ''}>âŒ Despido</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="periodo_inicio">PerÃ­odo desde</label>
            <input type="date" id="periodo_inicio" name="periodo_inicio" value="${filtros.periodo_inicio || ''}">
          </div>

          <div class="form-group">
            <label for="periodo_fin">PerÃ­odo hasta</label>
            <input type="date" id="periodo_fin" name="periodo_fin" value="${filtros.periodo_fin || ''}">
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">ğŸ” Buscar</button>
          <a href="/evaluaciones" class="btn btn-secondary">ğŸ”„ Limpiar</a>
        </div>
      </form>
    </div>

    <!-- Tabla de evaluaciones -->
    <div class="table-card">
      <h3>ğŸ“Š Evaluaciones Registradas (${evaluaciones.length})</h3>
      
      ${evaluaciones.length === 0 ? `
        <p style="text-align: center; padding: 2rem; color: #666;">
          ğŸ“­ No hay evaluaciones registradas
        </p>
      ` : `
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Empleado</th>
                <th>TÃ­tulo</th>
                <th>Tipo</th>
                <th>Puntaje General</th>
                <th>RecomendaciÃ³n</th>
                <th>Premio</th>
                <th>PerÃ­odo</th>
                <th>Evaluador</th>
                <th>Fecha</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              ${evaluaciones.map(e => `
                <tr>
                  <td><strong>#${e.id}</strong></td>
                  <td>
                    <strong>${e.usuario_nombre}</strong><br>
                    <small>${e.usuario_email}</small><br>
                    <small class="badge badge-secondary">${e.empresa_nombre || 'Sin empresa'}</small>
                  </td>
                  <td>
                    <strong>${e.titulo}</strong>
                    ${e.imagenes && e.imagenes.length > 0 ? '<br><small>ğŸ“ ' + e.imagenes.length + ' archivos</small>' : ''}
                  </td>
                  <td><span class="badge badge-info">${e.tipo || 'general'}</span></td>
                  <td>
                    ${e.puntaje_general ? `
                      <strong style="font-size: 1.2rem; color: ${
                        e.puntaje_general >= 8 ? '#28a745' : 
                        e.puntaje_general >= 6 ? '#ffc107' : 
                        '#dc3545'
                      };">${e.puntaje_general}/10</strong>
                    ` : 'N/A'}
                  </td>
                  <td>
                    ${e.recomendacion ? `
                      <span class="badge ${
                        e.recomendacion === 'premio' ? 'badge-success' :
                        e.recomendacion === 'aumento' ? 'badge-success' :
                        e.recomendacion === 'capacitacion' ? 'badge-info' :
                        e.recomendacion === 'advertencia' ? 'badge-warning' :
                        'badge-danger'
                      }">
                        ${
                          e.recomendacion === 'premio' ? 'ğŸ† Premio' :
                          e.recomendacion === 'aumento' ? 'ğŸ’° Aumento' :
                          e.recomendacion === 'capacitacion' ? 'ğŸ“š CapacitaciÃ³n' :
                          e.recomendacion === 'advertencia' ? 'âš ï¸ Advertencia' :
                          'âŒ Despido'
                        }
                      </span>
                    ` : 'N/A'}
                  </td>
                  <td>
                    ${e.aprobado_para_premio ? 
                      '<span class="badge badge-success">âœ… Aprobado</span>' : 
                      '<span class="badge badge-secondary">â– No</span>'
                    }
                    ${e.monto_sugerido ? '<br><small>$' + parseFloat(e.monto_sugerido).toLocaleString('es-AR') + '</small>' : ''}
                  </td>
                  <td>
                    ${e.periodo_inicio ? new Date(e.periodo_inicio).toLocaleDateString('es-AR') : 'â€”'}
                    <br>a<br>
                    ${e.periodo_fin ? new Date(e.periodo_fin).toLocaleDateString('es-AR') : 'â€”'}
                  </td>
                  <td>
                    <small>${e.evaluador_nombre}</small>
                  </td>
                  <td>${new Date(e.fecha_creacion).toLocaleDateString('es-AR')}</td>
                  <td>
                    <div class="action-buttons">
                      <a href="/evaluaciones/${e.id}" class="btn-small btn-primary">ğŸ‘ï¸ Ver</a>
                      <a href="/evaluaciones/${e.id}/editar" class="btn-small btn-secondary">âœï¸ Editar</a>
                    </div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `}
    </div>

    <!-- Resumen estadÃ­stico -->
    <div class="stats-grid" style="margin-top: 2rem;">
      <div class="stat-card">
        <span class="stat-value">${evaluaciones.length}</span>
        <span class="stat-label">Total Evaluaciones</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">${evaluaciones.filter(e => e.aprobado_para_premio).length}</span>
        <span class="stat-label">ğŸ† Aprobados para Premio</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">${evaluaciones.filter(e => e.puntaje_general >= 8).length}</span>
        <span class="stat-label">â­ Excelente (8-10)</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">${evaluaciones.filter(e => e.puntaje_general >= 6 && e.puntaje_general < 8).length}</span>
        <span class="stat-label">ğŸ‘ Bueno (6-7)</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">${evaluaciones.filter(e => e.puntaje_general < 6).length}</span>
        <span class="stat-label">âš ï¸ Necesita Mejorar (<6)</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">$${evaluaciones.reduce((sum, e) => sum + (parseFloat(e.monto_sugerido) || 0), 0).toLocaleString('es-AR')}</span>
        <span class="stat-label">ğŸ’° Total Sugerido</span>
      </div>
    </div>
  </div>

  <style>
    .filter-card {
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn-small {
      padding: 0.4rem 0.8rem;
      font-size: 0.875rem;
    }
  </style>
` }) %>
