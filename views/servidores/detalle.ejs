<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Sistema de Inventario</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <%- include('../partials/header') %>

  <main class="container">
    <div class="page-header">
      <h1>ğŸ–§ <%= servidor.nombre %></h1>
      <a href="/servidores" class="btn btn-secondary">â¬…ï¸ Volver al listado</a>
    </div>

    <div class="detail-card">
      <div class="detail-header">
        <h2>InformaciÃ³n General</h2>
        <% if (servidor.tipo) { %>
          <span class="badge badge-primary"><%= servidor.tipo %></span>
        <% } %>
        <span class="badge <%= servidor.activo ? 'badge-success' : 'badge-danger' %>">
          <%= servidor.activo ? 'âœ… Activo' : 'âŒ Inactivo' %>
        </span>
      </div>

      <div class="detail-content">
        <div class="detail-row">
          <div class="detail-item">
            <label>ğŸ¢ Empresa</label>
            <p><%= servidor.empresa_nombre %></p>
          </div>
          <div class="detail-item">
            <label>ğŸ“ Nombre del Servidor</label>
            <p><strong><%= servidor.nombre %></strong></p>
          </div>
        </div>

        <div class="detail-row">
          <div class="detail-item">
            <label>ğŸŒ IP Externa</label>
            <p>
              <% if (servidor.ip_externa) { %>
                <code><%= servidor.ip_externa %></code>
                <button class="btn-copy" onclick="copyToClipboard('<%= servidor.ip_externa %>')">ğŸ“‹</button>
              <% } else { %>
                <em>No especificada</em>
              <% } %>
            </p>
          </div>
          <div class="detail-item">
            <label>ğŸ”Œ Puerto</label>
            <p>
              <% if (servidor.puerto) { %>
                <code><%= servidor.puerto %></code>
                <button class="btn-copy" onclick="copyToClipboard('<%= servidor.puerto %>')">ğŸ“‹</button>
              <% } else { %>
                <em>No especificado</em>
              <% } %>
            </p>
          </div>
        </div>

        <div class="detail-row">
          <div class="detail-item">
            <label>ğŸ  IP Interna</label>
            <p>
              <code><%= servidor.ip_interna %></code>
              <button class="btn-copy" onclick="copyToClipboard('<%= servidor.ip_interna %>')">ğŸ“‹</button>
            </p>
          </div>
          <div class="detail-item">
            <label>ğŸ‘¤ Usuario</label>
            <p>
              <% if (servidor.usuario) { %>
                <code><%= servidor.usuario %></code>
                <button class="btn-copy" onclick="copyToClipboard('<%= servidor.usuario %>')">ğŸ“‹</button>
              <% } else { %>
                <em>No especificado</em>
              <% } %>
            </p>
          </div>
        </div>

        <div class="detail-row">
          <div class="detail-item full-width">
            <label>ğŸ”‘ ContraseÃ±a</label>
            <p>
              <% if (servidor.password) { %>
                <code id="password-field">********</code>
                <button class="btn-toggle" onclick="togglePassword()">ğŸ‘ï¸ Mostrar</button>
                <button class="btn-copy" onclick="copyToClipboard('<%= servidor.password %>')">ğŸ“‹ Copiar</button>
                <input type="hidden" id="password-value" value="<%= servidor.password %>">
              <% } else { %>
                <em>No especificada</em>
              <% } %>
            </p>
          </div>
        </div>

        <% if (servidor.observaciones) { %>
          <div class="detail-row">
            <div class="detail-item full-width">
              <label>ğŸ“‹ Observaciones</label>
              <p><%= servidor.observaciones %></p>
            </div>
          </div>
        <% } %>

        <div class="detail-row">
          <div class="detail-item">
            <label>ğŸ“… Fecha de CreaciÃ³n</label>
            <p><%= new Date(servidor.fecha_creacion).toLocaleString('es-AR') %></p>
          </div>
          <div class="detail-item">
            <label>ğŸ”„ Ãšltima ActualizaciÃ³n</label>
            <p><%= new Date(servidor.fecha_actualizacion).toLocaleString('es-AR') %></p>
          </div>
        </div>
      </div>
    </div>

    <% if (user.rol === 'skn_admin' || user.rol === 'empresa_admin') { %>
      <div class="form-actions">
        <a href="/servidores/editar/<%= servidor.id %>" class="btn btn-warning">âœï¸ Editar</a>
        <button onclick="confirmarEliminar()" class="btn btn-danger">ğŸ—‘ï¸ Eliminar</button>
      </div>
    <% } %>
  </main>

  <%- include('../partials/footer') %>

  <script>
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert('âœ… Copiado al portapapeles');
      }).catch(err => {
        console.error('Error al copiar:', err);
      });
    }

    function togglePassword() {
      const field = document.getElementById('password-field');
      const value = document.getElementById('password-value').value;
      const btn = event.target;
      
      if (field.textContent === '********') {
        field.textContent = value;
        btn.textContent = 'ğŸ™ˆ Ocultar';
      } else {
        field.textContent = '********';
        btn.textContent = 'ğŸ‘ï¸ Mostrar';
      }
    }

    function confirmarEliminar() {
      if (confirm('âš ï¸ Â¿EstÃ¡ seguro de eliminar este servidor?\nEsta acciÃ³n no se puede deshacer.')) {
        // TODO: Implementar endpoint de eliminaciÃ³n
        alert('ğŸš§ Funcionalidad de eliminaciÃ³n pendiente');
      }
    }
  </script>
